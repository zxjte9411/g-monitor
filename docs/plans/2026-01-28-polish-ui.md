# Polish Labels and TUI Grouping/Sorting Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Update 'VSCode' to 'Antigravity', fix label formatting, and add interactive sorting to the TUI.

**Architecture:** 
1. Centralize label generation or update occurrences in `status.ts` and `App.tsx`.
2. Add `sortMode` state to `App.tsx` and implement sorting logic in `transformData`.
3. Update `Footer.tsx` to reflect the new `g` key binding for sorting.

**Tech Stack:** TypeScript, React (Ink), Commander.js

### Task 1: Fix Labels in status.ts

**Files:**
- Modify: `D:/g-monitor/src/commands/status.ts:127-151`

**Step 1: Modify identityMap and label formatting**

```typescript
                const identityMap: Record<string, string> = {
                    'antigravity': 'Antigravity',
                    'gemini-cli': 'CLI'
                };
                const poolLabel = `${source}/${identityMap[identity] || identity}`;

                for (const bucket of buckets) {
                    if (!bucket.modelId) continue;
                    
                    const id = bucket.modelId;
                    const existing = modelMap.get(id);
                    
                    const uniqueKey = `${id}|${source}|${identity}`;
                    
                    let displayName = existing?.displayName || id;
                    if (id === 'gemini-3-pro-high') displayName = 'Gemini 3 Pro (High)';
                    if (id === 'gemini-3-pro-low') displayName = 'Gemini 3 Pro (Low)';
                    if (id === 'gemini-3-flash') displayName = 'Gemini 3 Flash';

                    modelMap.set(uniqueKey, {
                        id,
                        displayName: `${displayName} ${chalk.dim(`[${poolLabel}]`)}`,
                        remainingFraction: bucket.remainingFraction,
                        resetTime: bucket.resetTime
                    });
                }
```

**Step 2: Verify by running status (mocked or actual if possible)**
Since I can't easily run the full tool without credentials, I'll rely on code review and unit tests if they exist.

**Step 3: Commit**

```bash
git add src/commands/status.ts
git commit -m "feat: update VSCode to Antigravity and polish labels in status command"
```

### Task 2: Fix Labels in App.tsx

**Files:**
- Modify: `D:/g-monitor/src/ui/App.tsx:138-155`

**Step 1: Modify identityMap and label formatting in transformData**

```typescript
                const identityMap: Record<string, string> = {
                    'antigravity': 'Antigravity',
                    'gemini-cli': 'CLI'
                };
                const poolLabel = `${res.source}/${identityMap[res.identity] || res.identity}`;

                res.data.buckets.forEach(bucket => {
                    if (!bucket.modelId) return;
                    
                    let displayName = modelMap.get(bucket.modelId)?.displayName || bucket.modelId;
                    
                    // Special case overrides
                    if (bucket.modelId === 'gemini-3-pro-high') displayName = 'Gemini 3 Pro Preview (High)';
                    if (bucket.modelId === 'gemini-3-pro-low') displayName = 'Gemini 3 Pro Preview (Low)';
                    if (bucket.modelId === 'gemini-3-flash') displayName = 'Gemini 3 Flash Preview';

                    quotaItems.push({
                        name: `${displayName} [${poolLabel}]`,
                        remaining: Math.round(bucket.remainingFraction * 100),
                        limit: 100,
                        resetTime: bucket.resetTime,
                        source: res.source,
                        // Add fields for sorting
                        poolLabel,
                        remainingFraction: bucket.remainingFraction,
                        displayName
                    });
                });
```

**Step 2: Update QuotaData interface if necessary (check QuotaTable.tsx)**
I need to check `src/ui/components/QuotaTable.tsx` to see if I need to update the interface.

**Step 3: Commit**

```bash
git add src/ui/App.tsx
git commit -m "feat: update VSCode to Antigravity and polish labels in TUI"
```

### Task 3: Implement TUI Sorting Logic in App.tsx

**Files:**
- Modify: `D:/g-monitor/src/ui/App.tsx`

**Step 1: Add sortMode state**

```typescript
    const [sortMode, setSortMode] = useState<'name' | 'pool' | 'status'>('name');
```

**Step 2: Add key handler for 'g'**

```typescript
        if (input === 'g') {
            setSortMode(current => {
                if (current === 'name') return 'pool';
                if (current === 'pool') return 'status';
                return 'name';
            });
        }
```

**Step 3: Update transformData sorting logic**

```typescript
        // Sort logic
        return quotaItems.sort((a, b) => {
            if (sortMode === 'name') {
                return a.name.localeCompare(b.name);
            }
            if (sortMode === 'pool') {
                const poolComp = a.poolLabel.localeCompare(b.poolLabel);
                return poolComp !== 0 ? poolComp : a.name.localeCompare(b.name);
            }
            if (sortMode === 'status') {
                const statusComp = (a.remainingFraction || 0) - (b.remainingFraction || 0);
                return statusComp !== 0 ? statusComp : a.name.localeCompare(b.name);
            }
            return 0;
        });
```

**Step 4: Commit**

```bash
git add src/ui/App.tsx
git commit -m "feat: implement sorting by name, pool, and status in TUI"
```

### Task 4: Update Footer.tsx

**Files:**
- Modify: `D:/g-monitor/src/ui/components/Footer.tsx`

**Step 1: Pass sortMode to Footer (requires updating App.tsx and Footer.tsx)**

In `App.tsx`:
```tsx
<Footer sortMode={sortMode} />
```

In `Footer.tsx`:
```tsx
export const Footer: React.FC<{ sortMode: string }> = ({ sortMode }) => {
    const modeLabel = sortMode.charAt(0).toUpperCase() + sortMode.slice(1);
    // ... update render to show [G]roup: {modeLabel}
```

**Step 2: Commit**

```bash
git add src/ui/App.tsx src/ui/components/Footer.tsx
git commit -m "feat: show current sort mode in footer"
```
